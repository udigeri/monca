<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8" />
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <title>Moneris testing</title>
        <meta name="description" content="Testing Moneris checkout" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <script src="https://gatewayt.moneris.com/chktv2/js/chkt_v2.00.js"></script>
        <script src="https://code.jquery.com/jquery-3.7.0.min.js"></script>
        <link rel="stylesheet" href="styles/normalize.css" />
        <link rel="stylesheet" href="styles/style.css" />
    </head>

    <body>
        <div class="app">
            <aside>
                <h1 id="title">command</h1>
                <form>
                    <input id="ticketNumber" type="text" placeholder="TicketNr." />
                </form>
                <header class="redirect">
                    <button id="startTicketButton">Ticket</button>
                    <button id="startCheckoutButton">Checkout</button>
                    <button id="startReceiptButton">Receipt</button>
                </header>

                <div class="order">
                    <section class="header center">
                        <div class="header-text"></div>
                        <img
                            class="header-image"
                            alt="S&B logo"
                            src="https://www.scheidt-bachmann.de/fileadmin/templates/img/sblogo.svg"
                        />
                    </section>

                    <section class="order-details">
                        <!-- <span class="order-id">Order ID</span>
                        <p class="cart">
                            <svg style="stroke: #78787878" viewBox="0 0 122.88 122.88">
                                <path
                                    d="M25.27,86.92c-1.81,0-3.26-1.46-3.26-3.26s1.47-3.26,3.26-3.26h21.49c1.81,0,3.26,1.46,3.26,3.26s-1.46,3.26-3.26,3.26 H25.27L25.27,86.92L25.27,86.92z M61.1,77.47c-0.96,0-1.78-0.82-1.78-1.82c0-0.96,0.82-1.78,1.78-1.78h4.65c0.04,0,0.14,0,0.18,0 c1.64,0.04,3.1,0.36,4.33,1.14c1.37,0.87,2.37,2.19,2.92,4.15c0,0.04,0,0.09,0.05,0.14l0.46,1.82h39.89c1,0,1.78,0.82,1.78,1.78 c0,0.18-0.05,0.36-0.09,0.55l-4.65,18.74c-0.18,0.82-0.91,1.37-1.73,1.37l0,0l-29.18,0c0.64,2.37,1.28,3.65,2.14,4.24 c1.05,0.68,2.87,0.73,5.93,0.68h0.04l0,0h20.61c1,0,1.78,0.82,1.78,1.78c0,1-0.82,1.78-1.78,1.78H87.81l0,0 c-3.79,0.04-6.11-0.05-7.98-1.28c-1.92-1.28-2.92-3.46-3.92-7.43l0,0L69.8,80.2c0-0.05,0-0.05-0.04-0.09 c-0.27-1-0.73-1.69-1.37-2.05c-0.64-0.41-1.5-0.59-2.51-0.59c-0.05,0-0.09,0-0.14,0H61.1L61.1,77.47L61.1,77.47z M103.09,114.13 c2.42,0,4.38,1.96,4.38,4.38s-1.96,4.38-4.38,4.38s-4.38-1.96-4.38-4.38S100.67,114.13,103.09,114.13L103.09,114.13L103.09,114.13z M83.89,114.13c2.42,0,4.38,1.96,4.38,4.38s-1.96,4.38-4.38,4.38c-2.42,0-4.38-1.96-4.38-4.38S81.48,114.13,83.89,114.13 L83.89,114.13L83.89,114.13z M25.27,33.58c-1.81,0-3.26-1.47-3.26-3.26c0-1.8,1.47-3.26,3.26-3.26h50.52 c1.81,0,3.26,1.46,3.26,3.26c0,1.8-1.46,3.26-3.26,3.26H25.27L25.27,33.58L25.27,33.58z M7.57,0h85.63c2.09,0,3.99,0.85,5.35,2.21 s2.21,3.26,2.21,5.35v59.98h-6.5V7.59c0-0.29-0.12-0.56-0.31-0.76c-0.2-0.19-0.47-0.31-0.76-0.31l0,0H7.57 c-0.29,0-0.56,0.12-0.76,0.31S6.51,7.3,6.51,7.59v98.67c0,0.29,0.12,0.56,0.31,0.76s0.46,0.31,0.76,0.31h55.05 c0.61,2.39,1.3,4.48,2.23,6.47H7.57c-2.09,0-3.99-0.85-5.35-2.21C0.85,110.24,0,108.34,0,106.25V7.57c0-2.09,0.85-4,2.21-5.36 S5.48,0,7.57,0L7.57,0L7.57,0z M25.27,60.25c-1.81,0-3.26-1.46-3.26-3.26s1.47-3.26,3.26-3.26h50.52c1.81,0,3.26,1.46,3.26,3.26 s-1.46,3.26-3.26,3.26H25.27L25.27,60.25L25.27,60.25z"
                                />

                            </svg>
                            <span>38f0d2d0-53ea-4872-a980-0d8e793aa827</span>
                        </p> -->
                        <span class="order-id">Client ID</span>
                        <p class="cart">
                            <svg style="stroke: #78787878" viewBox="0 0 122.88 122.88">
                                <path
                                    d="M34.02,65.66c5.81,12.12,23.43,12.54,28.99,0.07c-1.51-1.54-2.64-3.19-3.76-4.82 c-0.18-0.26-0.37-0.54-0.56-0.8c-2.69,2.13-5.94,3.49-10.19,3.48c-4.58-0.01-8.03-1.77-10.86-4.35c-0.17-0.15-0.34-0.31-0.5-0.47 c-0.4,1.13-0.92,2.47-1.47,3.73C35.13,63.69,34.56,64.84,34.02,65.66L34.02,65.66L34.02,65.66z M104.88,56.89V78.4l-8.6-5.04 l-8.66,5.47V56.89H75.39c-1.16,0-2.12,0.95-2.12,2.12v29.34c0,1.16,0.96,2.11,2.12,2.11h41.73c1.16,0,2.11-0.96,2.11-2.11V59 c0-1.16-0.95-2.12-2.11-2.12H104.88L104.88,56.89z M91.27,56.89v15.34l4.94-3.12l5.03,2.95V56.89H91.27L91.27,56.89z M75.39,53.24 h12.24h17.26h12.24c1.58,0,3.01,0.65,4.06,1.69l0.01,0.01c1.04,1.04,1.69,2.48,1.69,4.06v29.34c0,1.57-0.65,3.01-1.69,4.05 l-0.01,0.01c-1.05,1.04-2.49,1.69-4.05,1.69H93.79c-0.06,0.03-0.13,0.06-0.19,0.08H2.51c-3.54-0.7-5.39-13.17,8.9-21.14 c5.77-3.22,14.63-4.28,20.86-8.63c0.46-0.69,0.95-1.69,1.43-2.77c0.71-1.64,1.37-3.42,1.79-4.63c-1.75-2.05-3.23-4.37-4.67-6.66 l-4.73-6.14c-1.73-2.58-2.62-4.94-2.68-6.86c-0.03-0.91,0.13-1.74,0.46-2.46c0.36-0.76,0.89-1.39,1.63-1.89 c0.34-0.23,0.72-0.42,1.15-0.58c-0.31-4.07-0.42-7.83-0.23-12.14c0.1-1.02,0.3-2.04,0.58-3.06c5.72-20.36,35.63-22.69,39.84-6.77 c2.62,2.84,4.27,6.6,4.63,11.58L71.17,32.9l0,0c1.31,0.4,2.15,1.23,2.49,2.58c0.38,1.49-0.03,3.59-1.3,6.46l0,0 c-0.02,0.05-0.05,0.1-0.08,0.15l-5.39,7.49c-1.97,3.26-3.99,6.53-6.61,9.1c0.23,0.34,0.47,0.69,0.71,1.02 c1.07,1.56,2.14,3.13,3.53,4.53c0.05,0.04,0.08,0.08,0.11,0.13l0,0c1.57,1.11,3.25,2,4.99,2.77V59c0-1.59,0.65-3.03,1.69-4.07 C72.36,53.89,73.8,53.24,75.39,53.24L75.39,53.24z M29.38,34.6c-1.04,0.04-1.84,0.25-2.38,0.62c-0.31,0.21-0.54,0.47-0.69,0.79 c-0.16,0.35-0.24,0.78-0.23,1.27c0.04,1.44,0.8,3.32,2.25,5.48l0.02,0.03l0,0l4.73,6.14c1.89,3.02,3.88,6.08,6.35,8.34 c2.38,2.17,5.26,3.64,9.06,3.65c4.13,0.01,7.15-1.51,9.59-3.81c2.55-2.39,4.56-5.65,6.54-8.91l5.32-7.39 c1-2.27,1.35-3.78,1.13-4.66c-0.13-0.53-0.71-0.79-1.71-0.84c-0.21-0.01-0.43-0.01-0.65-0.01c-0.24,0.01-0.49,0.02-0.74,0.05 c-0.14,0.01-0.28,0-0.41-0.03c-0.47,0.03-0.96-0.01-1.46-0.08l1.82-6.69c-13.53,2.13-23.65-7.92-37.95-2.01l1.03,8.13 C30.42,34.69,29.89,34.67,29.38,34.6L29.38,34.6L29.38,34.6L29.38,34.6z"
                                />
                            </svg>
                            <span>9abdd2d0-53ea-4872-a980-0d8e793abc54</span>
                        </p>
                    </section>

                    <div
                        id="moneris-apple-pay"
                        store-id="store 1"
                        merchant-identifier="simple.moneris.effective-meme-9x4j9g94wxrf9xx9-5500.app.github.dev"
                        display-name="Ta testuje"
                    ></div>
                    <div
                        id="outerDiv"
                        style="
                            height: 700px;
                            margin-top: 10px;
                            border: 0px dotted blue;
                            border-radius: 10px;
                        "
                    >
                        <div id="monerisCheckout"></div>
                    </div>

                    <section class="footer right">
                        <div class="footer-text">Powered by</div>
                        <img
                            class="footer-image"
                            alt="Moneris Logo"
                            src="https://gatewayt.moneris.com/chktv2/style/images/mon_logo_chkt.png"
                        />
                    </section>
                </div>

                <!-- Modal window for displaying the receipt -->
                <div id="receiptModal">
                    <div id="receiptModalContent">
                        <span id="closeModal">Ã—</span>
                        <h2>Payment Receipt</h2>
                        <div id="receiptDetails"></div>
                    </div>
                </div>
            </aside>
            <main>
                <h1 id="title">Log</h1>
                <div id="rsp" class="rsp"></div>
            </main>
            <script src="js/callbacks.js"></script>
            <script>
                // Instantiate the monerisCheckout object
                let checkoutInst = new monerisCheckout();
                const cb = {
                    checkout: checkoutInst,
                    pageLoaded: myPageLoad,
                    cancelTransaction: myCancelTransaction,
                };

                // Set the environment mode: "qa" for testing or "production" for live transactions
                checkoutInst.setMode("qa");

                // Specify the div where the checkout form will be rendered
                checkoutInst.setCheckoutDiv("monerisCheckout");

                // Set up the necessary callbacks
                checkoutInst.setCallback("page_loaded", cb.pageLoaded);
                checkoutInst.setCallback("cancel_transaction", cb.cancelTransaction);
                //checkoutInst.setCallback("payment_receipt", myPaymentReceipt);
                checkoutInst.setCallback("payment_complete", myPaymentComplete);
                checkoutInst.setCallback("error_event", myErrorEvent);
                // checkoutInst.setCallback("payment_submit", myPaymentSubmit);
                // checkoutInst.setCallback("remove_back_button", myRemoveBackButton);
                checkoutInst.setCallback("page_closed", myPageClosed);
                checkoutInst.setCallback("payment_submitted", myPaymentSubmitted);
                checkoutInst.setCallback("validation_event", myValidationEvent);

                const queryParams = new URLSearchParams(window.location.search);
                document.getElementById("ticketNumber").value = queryParams.get("tck");

                for (const param of queryParams) {
                    console.log(param);
                }
                // Execute a function when the user presses a key on the keyboard
                document
                    .getElementById("ticketNumber")
                    .addEventListener("keypress", function (event) {
                        if (event.key === "Enter") {
                            event.preventDefault();
                            document.getElementById("startCheckoutButton").click();
                        }
                    });

                // Event listener for the start checkout button
                document.getElementById("startTicketButton").addEventListener("click", function () {
                    initializeMonerisTicket();
                });
                // Event listener for the start checkout button
                document
                    .getElementById("startCheckoutButton")
                    .addEventListener("click", function () {
                        var ticketNumber = document.getElementById("ticketNumber").value;
                        initializeMonerisCheckout(checkoutInst, ticketNumber);
                    });
                // Event listener for the start receipt button
                document
                    .getElementById("startReceiptButton")
                    .addEventListener("click", function () {
                        var ticketNumber = document.getElementById("ticketNumber").value;
                        if (ticketNumber) {
                            initializeMonerisReceipt(ticketNumber);
                        } else {
                            alert("Please enter a ticket number.");
                        }
                    });
                // Close the modal when the user clicks on <span> (x)
                document.getElementById("closeModal").onclick = function () {
                    document.getElementById("receiptModal").style.display = "none";
                };

                // Close the modal when the user clicks anywhere outside of the modal
                window.onclick = function (event) {
                    if (event.target == document.getElementById("receiptModal")) {
                        document.getElementById("receiptModal").style.display = "none";
                    }
                };
            </script>
            <script src="js/moneris.js"></script>
        </div>
    </body>
</html>
